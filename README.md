# 坦克大战 (Battle City) v2.0

一个基于HTML5 Canvas技术开发的经典坦克大战游戏，忠实还原FC红白机时代的经典玩法，并加入现代化视觉优化和创新游戏机制。包含多子弹系统、创新道具、连击系统、分数倍增和成就系统。

![游戏截图](screenshot.png)

## 🎮 游戏简介

这是一款致敬经典FC游戏《坦克大战》的Web版本，采用现代化的JavaScript技术栈，完整实现了原作的核心玩法并加入创新系统。

**v2.0重大更新亮点**：
- 🔥 **多子弹系统**：收集星星增加子弹发射数量，最多可同时发射多发子弹
- ⚡ **创新道具**：护盾、激光、导弹三大创新道具带来全新战术体验
- 💫 **连击系统**：连续击杀累积连击，享受分数倍增奖励
- 🏆 **成就系统**：8种成就等你解锁，挑战极限操作
- 🎯 **碰撞优化**：坦克之间不再重叠，更真实的战斗体验

游戏特色包括：精致的坦克建模（履带、炮塔、主体）、红底黄星基地设计、穿甲弹系统、击杀提速机制等。玩家需要保护基地，消灭所有敌方坦克以完成关卡。

## ✨ 核心特性

### 游戏系统
- **高性能游戏引擎**：60FPS流畅运行，基于requestAnimationFrame的游戏循环
- **模块化设计**：采用ES6类系统，清晰的代码结构
- **实体管理系统**：统一管理坦克、子弹、道具、爆炸等游戏对象
- **精确碰撞检测**：包围盒检测算法，支持子弹与地形、坦克、其他子弹的碰撞

### 地形系统（6种地形）
| 地形类型 | 特性 | 视觉效果 |
|---------|------|---------|
| 🟫 砖墙 | 可被子弹摧毁，阻挡坦克移动 | 棕色砖块纹理，交错排列 |
| ⬜ 钢铁 | 仅3级子弹或穿甲弹可摧毁，阻挡坦克移动 | 银灰色金属光泽，四格渐变 |
| 🟦 水域 | 坦克无法通过，子弹可飞越 | 深蓝色水面，动态水波纹理 |
| 🟩 丛林 | 坦克可进入并被遮蔽，子弹可穿透 | 绿色树冠图案，亮色点缀 |
| ❄️ 冰面 | 坦克在上面移动速度加快（滑行效果） | 浅蓝色冰面，冰裂纹和冰晶高光 |
| ⭐ 基地 | 游戏目标，被摧毁则失败 | 红色背景 + 黄色五角星 |

### 坦克系统

#### 玩家坦克
- **初始属性**：速度100px/s，生命值1，子弹速度300px/s
- **外观设计**：绿色系，包含履带、主体、炮塔和炮管的精细建模
- **升级系统**（通过星星道具）：
  - **1级**：子弹速度提升至400px/s
  - **2级**：可同时发射2发子弹
  - **3级**：子弹速度500px/s，生命值+1，可摧毁钢铁
- **击杀提速**：每击杀1个敌人，速度提升5%，最高30%（6次击杀）
- **复活机制**：死亡后3秒无敌保护期

#### 敌方坦克（4种类型）

| 类型 | 颜色 | 速度 | 血量 | 子弹速度 | AI特性 | 视觉特征 |
|------|------|------|------|---------|--------|---------|
| 基础型 | 🔴 红色系 | 80 | 1 | 250 | 随机移动，射击间隔长 | 红色履带+主体+炮塔 |
| 快速型 | 🟣 紫色系 | 160 | 1 | 300 | 高速移动，迂回包抄 | 紫色履带+主体+炮塔 |
| 装甲型 | 🟢 绿色系 | 60 | 4 | 280 | 坦克坚固，持续推进 | 绿色履带+主体+炮塔 |
| 加强型 | 🔵 青色系 | 100 | 2 | 400 | 智能AI，主动攻击基地 | 青色履带+主体+炮塔 |

**视觉设计**：所有坦克都具有：
- 深色履带（带动态纹理）
- 装甲主体（带边框线条）
- 中央圆形炮塔
- 随方向旋转的黑色炮管

### 道具系统

#### 经典道具
| 道具 | 图标 | 效果 | 持续时间 |
|------|------|------|---------|
| 星星 | ★ 黄色星星 | 增加1发子弹（累计，1+n发） | 永久 |
| 坦克 | 🚙 绿色小坦克 | 获得1条额外生命 | 永久 |
| 炸弹 | ● 红色圆点 | 消灭屏幕上所有敌方坦克 | 瞬发 |
| 秒表 | ◐ 蓝色时钟 | 冻结所有敌方坦克 | 5秒 |
| 头盔 | ◆ 灰色菱形 | 玩家坦克无敌状态 | 10秒 |
| 铲子 | ▲ 棕色三角 | 将基地周围砖墙升级为钢铁 | 20秒 |
| 手枪 | 🔫 黑色枪形 | 获得穿甲弹能力，可击穿钢板 | 永久 |

#### 创新道具 🆕
| 道具 | 图标 | 效果 | 子弹颜色 |
|------|------|------|---------|
| 护盾 | 🛡️ 蓝色护盾 | 抵挡3次伤害 | - |
| 激光 | ⚡ 青色闪电 | 子弹穿透敌人不消失 | 青色 |
| 导弹 | 🚀 紫色火箭 | 子弹自动追踪最近敌人 | 紫色 |

**子弹颜色标识**：
- 🟡 黄色：普通子弹
- 🟠 橙色：穿甲弹（穿透钢板）
- 🔵 青色：激光（穿透敌人）
- 🟣 紫色：导弹（自动追踪）

**道具获取**：击毁闪烁的敌方坦克后随机出现，10秒后消失

**道具概率**（权重系统）：
- ⭐ 星星：权重3（高概率）
- 🔫 手枪：权重3（高概率）
- 🚙 生命：权重2（中概率）
- 其他道具：权重1（基础概率）

### AI系统

#### 决策机制
- **基于有限状态机**：每1-3秒进行一次AI决策
- **随机移动模式**：基础型、快速型、装甲型采用随机方向移动
- **智能寻路模式**：加强型坦克70%概率朝基地方向移动，30%随机转向
- **自动射击**：根据坦克类型设置不同的射击频率

#### 行为特征
- **基础型**：直线移动，遇障碍随机转向，防御薄弱
- **快速型**：高速机动，难以瞄准，适合迂回战术
- **装甲型**：生命值高（需4发子弹），持续向前推进
- **加强型**：最强AI，会计算与基地的距离并主动接近

#### 重要特性
- **友军免伤系统**：敌方坦克之间不会互相攻击，只有玩家可以消灭敌军
- **智能AI**：不同类型坦克具有不同的移动和射击策略

## 🎯 关卡设计

游戏共有3个精心设计的关卡，难度递增：

### 关卡1：新手训练营
- **目标**：熟悉基本操作
- **地图特征**：开阔地带，散落的砖墙作为掩护
- **敌军配置**：18辆基础坦克 + 2辆快速坦克
- **设计要点**：基地防护简单，风险低，适合练习移动和射击

### 关卡2：走廊阻击战
- **目标**：学习利用地形防御
- **地图特征**：中央狭窄通道，侧面分支路线
- **敌军配置**：14辆基础坦克 + 4辆快速坦克 + 2辆装甲坦克
- **设计要点**：引导玩家在关键路口阻击，体验"一夫当关"

### 关卡3：钢铁防线
- **目标**：应对高强度攻击
- **地图特征**：大量钢铁障碍物构成主要防线
- **敌军配置**：12辆基础坦克 + 4辆快速坦克 + 4辆装甲坦克
- **设计要点**：利用钢铁作为永久掩体，考验持续作战能力

## 🕹️ 操作说明

### 键盘控制
| 按键 | 功能 |
|------|------|
| W | 向上移动 |
| S | 向下移动 |
| A | 向左移动 |
| D | 向右移动 |
| 空格 | 发射子弹 |
| P | 暂停/继续 |

### 游戏规则
1. **胜利条件**：消灭关卡内所有敌方坦克
2. **失败条件**：玩家生命值耗尽 或 基地被摧毁
3. **分数系统** 🆕：
   - 基础型坦克：100分
   - 快速型坦克：200分
   - 装甲型坦克：300分
   - 加强型坦克：400分
   - **连击倍率**：每3连击增加0.5倍分数（3连击=1.5倍，6连击=2倍，以此类推）
   - **连击重置**：3秒内未击杀敌人则重置连击

### 创新系统 🆕

#### 连击系统
- 在3秒内连续击杀敌人可累积连击数
- 连击数会实时显示在UI上
- 超时未击杀将自动重置连击

#### 分数倍增系统
- 每3连击增加0.5倍分数
- 实时显示当前倍率
- 最终得分 = 基础分数 × 分数倍率

#### 坦克碰撞检测
- 玩家坦克与NPC不会重叠
- NPC之间也不会重叠
- 使用AABB碰撞检测算法

#### 成就系统
共8种成就可解锁：

| 成就 | 图标 | 解锁条件 |
|------|------|---------|
| 首杀 | 🎯 | 击杀第一个敌人 |
| 三连杀 | 🔥 | 完成3连击 |
| 五连杀 | ⚡ | 完成5连击 |
| 无双 | 💫 | 完成10连击 |
| 千分达成 | 💯 | 分数达到1000 |
| 高手 | 🏆 | 分数达到5000 |
| 坚持不懈 | 🌟 | 通过第5关 |
| 收藏家 | 📦 | 收集所有类型道具 |

**成就提示**：解锁成就时会在屏幕中央显示金色提示框，3秒后自动消失

## 🚀 快速开始

### 运行游戏

#### 方法1：直接打开（推荐）
```bash
# 在浏览器中直接打开 index.html
open index.html  # macOS
start index.html # Windows
xdg-open index.html # Linux
```

#### 方法2：使用本地服务器
```bash
# Python 3
python -m http.server 8000

# Python 2
python -m SimpleHTTPServer 8000

# Node.js (需要先安装 http-server)
npx http-server
```

然后在浏览器中访问：`http://localhost:8000`

### 系统要求
- 现代浏览器（Chrome 90+, Firefox 88+, Safari 14+, Edge 90+）
- 支持HTML5 Canvas和ES6
- 推荐分辨率：1280x720以上

## 📁 项目结构

```
tank-game/
├── index.html          # 游戏主页面
├── game.js            # 游戏核心逻辑
├── README.md          # 项目文档
└── screenshot.png     # 游戏截图（可选）
```

## 🏗️ 技术架构

### 核心技术栈
- **HTML5 Canvas**：游戏渲染引擎
- **原生JavaScript (ES6+)**：游戏逻辑实现
- **面向对象编程**：基于类的实体系统

### 设计模式
- **实体-组件系统**：所有游戏对象继承自Entity基类
- **对象池模式**：高效管理子弹和爆炸效果
- **有限状态机**：敌方坦克AI决策
- **数据驱动设计**：关卡数据与代码分离

### 核心类结构

```
Entity (基类)
├── Tank (坦克基类)
│   ├── PlayerTank (继承自Tank，添加玩家控制)
│   └── EnemyTank (继承自Tank，添加AI逻辑)
├── Bullet (子弹)
├── PowerUp (道具)
└── Explosion (爆炸效果)

GameMap (地图管理)
Game (游戏主控制器)
```

### 核心算法

#### 碰撞检测（AABB算法）
```javascript
checkBoundsCollision(bounds1, bounds2) {
    return bounds1.x < bounds2.x + bounds2.width &&
           bounds1.x + bounds1.width > bounds2.x &&
           bounds1.y < bounds2.y + bounds2.height &&
           bounds1.y + bounds1.height > bounds2.y;
}
```

#### 游戏循环（Delta Time）
```javascript
gameLoop(currentTime) {
    const deltaTime = (currentTime - this.lastTime) / 1000;
    this.update(deltaTime);  // 更新游戏逻辑
    this.render();           // 渲染画面
    requestAnimationFrame(this.gameLoop);
}
```

## 🎨 游戏特色

### 视觉效果
- **像素风格**：采用image-rendering: pixelated保持复古感
- **精致坦克建模**：
  - 玩家坦克：绿色系，清晰的履带、主体、炮塔和炮管
  - 敌方坦克：红/紫/绿/青色系，每种类型有独特配色
  - 动态履带纹理：根据移动方向显示不同的履带效果
  - 炮管方向：随坦克朝向动态旋转
- **精致地形渲染**：
  - 砖墙：交错排列的砖块纹理
  - 钢铁：金属光泽和高光效果
  - 水域：动态水波动画效果
  - 森林：树冠图案和亮色点缀
  - 冰面：冰裂纹和冰晶高光
  - 基地：红色背景 + 黄色五角星图标
- **爆炸动画**：渐变扩散的爆炸效果
- **无敌闪烁**：坦克无敌状态的视觉反馈
- **道具图标**：每种道具都有独特的视觉设计
  - 生命道具：绿色小坦克像素画
  - 手枪道具：黑色枪身+橙色火焰

### 音效系统（预留接口）
代码中已预留音效触发点：
- 坦克移动音效
- 射击音效
- 爆炸音效
- 道具拾取音效
- 关卡音乐

## 🔧 自定义开发

### 添加新关卡

在 `game.js` 中的 `LEVELS` 数组添加关卡配置：

```javascript
{
    enemies: [
        { type: TANK_TYPE.BASIC, count: 10 },
        { type: TANK_TYPE.FAST, count: 5 },
        { type: TANK_TYPE.ARMOR, count: 3 },
        { type: TANK_TYPE.POWER, count: 2 }
    ],
    map: generateCustomMap()
}
```

### 创建自定义地图

编写地图生成函数：

```javascript
function generateCustomMap() {
    const map = Array(MAP_HEIGHT).fill(null)
        .map(() => Array(MAP_WIDTH).fill(TERRAIN.EMPTY));

    // 添加障碍物
    for (let y = 5; y < 10; y++) {
        map[y][13] = TERRAIN.BRICK;
    }

    // 添加水域
    for (let x = 10; x < 15; x++) {
        for (let y = 10; y < 15; y++) {
            map[y][x] = TERRAIN.WATER;
        }
    }

    return map;
}
```

### 调整游戏难度

修改以下参数：

```javascript
// 玩家初始生命
this.lives = 5;  // 默认3

// 敌军同时出现数量
this.maxEnemiesOnScreen = 6;  // 默认4

// 敌军生成间隔
this.spawnInterval = 2;  // 默认3秒

// 道具存在时间
this.lifetime = 15;  // 默认10秒
```

## ✅ 版本更新日志

### v2.0 (最新版本) 🎉
**重大更新：创新玩法系统**

#### 核心功能
- ✅ **多子弹系统** - 星星道具改为增加子弹数量（1+n发），子弹扇形散射
- ✅ **创新道具系统** - 新增3种创新道具：
  - 🛡️ 护盾：提供3次伤害抵挡
  - ⚡ 激光：子弹穿透敌人不消失（青色）
  - 🚀 导弹：自动追踪最近敌人（紫色）
- ✅ **连击系统** - 3秒内连续击杀累积连击，实时显示
- ✅ **分数倍增** - 每3连击增加0.5倍分数奖励
- ✅ **成就系统** - 8种成就可解锁，带金色提示动画
- ✅ **坦克碰撞检测** - 玩家与NPC、NPC之间不会重叠
- ✅ **子弹颜色标识** - 不同类型子弹有不同颜色（黄/橙/青/紫）

#### Bug修复
- ✅ 修复shoot方法返回数组导致的bullet.update错误
- ✅ 修复所有DOM元素访问的空指针异常
- ✅ 优化游戏稳定性和错误处理

### v1.2
- ✅ **精致坦克建模** - 所有坦克都有履带、主体、炮塔和炮管的细节设计
  - 玩家坦克：绿色系配色
  - 敌方坦克：红/紫/绿/青色系，根据类型区分
  - 动态履带纹理效果
- ✅ **基地重新设计** - 从白头鹰改为红底黄星图标（单个方块）
- ✅ **击杀提速机制** - 每击杀敌人速度提升5%，最多30%
- ✅ **道具概率优化** - 星星和手枪道具出现概率提高3倍
- ✅ **修复重启bug** - 修复点击重新开始后游戏循环卡住的问题

### v1.1
- ✅ 修复敌方坦克互相攻击的bug
- ✅ 添加穿甲弹道具系统
- ✅ 优化生命+1道具图标为绿色小坦克
- ✅ 全面优化障碍物渲染

## 🐛 已知问题

- [ ] 冰面滑行效果可以进一步优化
- [ ] 暂未实现音效系统
- [ ] 移动端触控操作待添加

## 📝 开发计划

### v2.1 计划功能
- [ ] 添加完整音效系统（移动、射击、爆炸、道具）
- [ ] 优化成就提示动画效果
- [ ] 添加成就查看面板

### v2.5 计划功能
- [ ] 实现更多关卡（目标10关）
- [ ] 添加双人对战模式
- [ ] 移动端适配和触控操作
- [ ] 关卡编辑器
- [ ] 排行榜系统
- [ ] 存档功能

### v3.0 愿景
- [ ] 在线多人对战
- [ ] 自定义皮肤系统
- [ ] 关卡分享社区
- [ ] 赛季系统和天梯排名

## 🤝 贡献指南

欢迎提交Issue和Pull Request！

### 开发规范
1. 代码风格遵循项目现有规范
2. 添加新功能需更新文档
3. 提交前测试所有关卡
4. Commit信息使用中文描述

## 📄 版权声明

本项目是对经典FC游戏《坦克大战》的致敬之作，仅供学习和娱乐使用。

- 游戏玩法和设计理念参考自经典FC游戏
- 所有代码为原创实现，采用MIT协议开源
- 欢迎学习、修改和分享

## 🙏 致谢

- 感谢经典FC游戏《坦克大战》带来的童年回忆
- 感谢所有为复古游戏保护做出贡献的开发者

## 📮 联系方式

- 项目地址：[GitHub Repository URL]
- 问题反馈：[Issues]
- 讨论交流：[Discussions]

---

**享受游戏，保卫基地！** 🎮🔥
